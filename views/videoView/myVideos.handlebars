{{!-- views/videoView/myVideos.handlebars --}}
{{!-- layout: 'main' (n·∫øu c√≥) --}}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container my-5">
  <h2 class="mb-4 text-center text-warning">üìÅ Video c·ªßa b·∫°n</h2>

  {{#if videos.length}}
  <div class="table-responsive">
    <table class="table table-dark table-striped align-middle">
      <thead>
        <tr>
          <th>#</th>
          <th>Ti√™u ƒë·ªÅ</th>
          <th>Dung l∆∞·ª£ng (MB)</th>
          <th>Xem</th>
          <th>Xo√°</th>
        </tr>
      </thead>
      <tbody>
        {{#each videos}}
        <tr id="row-{{id}}">
          <td>{{id}}</td>
          <td>{{title}}</td>
          <td>{{size_mb}}</td>
          <td>
            <a class="btn btn-sm btn-outline-info" href="{{public_url}}" target="_blank">
              <i class="bi bi-play-circle"></i> Xem
            </a>
          </td>
          <td>
            <button class="btn btn-sm btn-outline-danger btn-del" data-id="{{id}}">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  {{else}}
    <p class="text-center text-muted">Ch∆∞a c√≥ video n√†o.</p>
  {{/if}}
</div>

<script>
/* XO√Å VIDEO */
document.querySelectorAll('.btn-del').forEach(btn => {
  btn.addEventListener('click', async () => {
    const id = btn.dataset.id;
    if (!confirm('Xo√° video #' + id + ' ?')) return;
    try {
      const res = await fetch('/api/videos/' + id, { method: 'DELETE' });
      const js  = await res.json();
      if (js.success) {
        document.getElementById('row-' + id).remove();
      } else {
        alert('L·ªói: ' + (js.error || 'kh√¥ng r√µ'));
      }
    } catch (e) {
      console.error(e);
      alert('Xo√° th·∫•t b·∫°i, xem console!');
    }
  });
});
</script>
